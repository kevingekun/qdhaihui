
(window.constructQBL=function(){window.QBL=window.QBL||{};(function(){var m=document.cookie.match(/(?:^|;+|\\s+)ptisp=([^;]*)/);var ptisp=!m?"":m[1]+'.';QBL.config={version:'2.0.0',host:location.host,siDomain:ptisp+'qzonestyle.gtimg.cn',imgcacheDomain:ptisp+'qzs.qq.com'};QBL.config.libDir='http://'+QBL.config.siDomain+'/qzone/biz/comm/qbl/';QBL.config.widgetDir='http://'+QBL.config.siDomain+'/qzone/biz/comm/widget/';})();QBL.genHash=function(str){var hash=5381;str=str||'';for(var i=0,len=str.length;i<len;++i){hash+=(hash<<5)+str.charAt(i).charCodeAt();}
return hash&0x7fffffff;};QBL.emptyFn=function(){};QBL.copydata=function(obj,preventName){if((typeof obj)=='object'){var res=QBL.isArray(obj)?[]:{};for(var i in obj){if(i!=preventName)
res[i]=QBL.copydata(obj[i],preventName);}
return res;}else if((typeof obj)=='function'){return Object;}
return obj;};QBL.isArray=function(obj){return Object.prototype.toString.call(obj).slice(8,-1).toLowerCase()=='array';};QBL.escString=function(str){var m={'\\\\':/\\/g,'\\/':/\//g,'\\n':/\n/g,'':/\r/g,'\\t':/\t/g,'\\\'':/\x27/g,'\\"':/\x22/g};str=str.toString();for(var x in m){str=str.replace(m[x],x);}
return str;};QBL.stringify=function(obj){var t,sw;if(typeof(obj)=='object'){if(obj===null){return'null';}
if(window.JSON&&window.JSON.stringify){return JSON.stringify(obj);}
sw=QBL.isArray(obj);t=[];for(var i in obj){t.push((sw?"":("\""+QBL.escString(i)+"\":"))+QBL.stringify(obj[i]));}
t=t.join();return sw?("["+t+"]"):("{"+t+"}");}else if(typeof(obj)=='undefined'){return'undefined';}else if(typeof(obj)=='number'||typeof(obj)=='function'){return obj.toString();}
return!obj?"\"\"":("\""+QBL.escString(obj)+"\"");};QBL.parseJSON=function(data){if(typeof data!=="string"||!data){return null;}
var rvalidchars=/^[\],:{}\s]*$/,rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rbrace=/^(?:\{.*\}|\[.*\])$/;data=data.replace(/^\s+|\s+$/g,'');if(rbrace.test(data)){data=(data+'').replace(/^\s+|\s+$/g,'');if(window.JSON&&window.JSON.parse){return window.JSON.parse(data);}
if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return(new Function("return "+data))();}}else{return data;}}
QBL.fnQueue=function(context){this.queue=[];this.context=context||null;};QBL.fnQueue.prototype={exec:function(){var item;for(var i=0,len=this.queue.length;i<len;i++){item=this.queue[i];item.length>1?item[0].apply(this.context,item[1]):item[0].apply(this.context);}},execOnce:function(){this.exec();this.queue=[];},add:function(fn,args){typeof fn==='function'&&this.queue.push(args?[fn,args]:[fn]);return this.queue.length-1;},insert:function(fn,args){typeof fn==='function'&&this.queue.unshift(args?[fn,args]:[fn]);return 0;},get:function(index){return index<=this.queue.length?this.queue[index]:null;}};QBL.crontab={_list:{},add:function(callback,timeout){var tasks=QBL.crontab._list;timeout+='';!(timeout in tasks)&&(tasks[timeout]=new QBL.fnQueue());tasks[timeout].add(callback);},exec:function(){var tasks=QBL.crontab._list;for(var x in tasks){x=parseInt(x,10);x>=0&&setTimeout(function(){tasks[x].execOnce();},x);}}};QBL.timepot=QBL.timepot||{};(function(){var cbQueue=new QBL.fnQueue(),isReady=false,isExecute=false;QBL.onReady=function(callback){!isReady?cbQueue.add(callback):callback;!isReady&&(!QBL.include._files||QBL.include._files.length===0)&&QBL.onReady.exec();};QBL.onReady.add=function(callback){cbQueue.add(callback);};QBL.onReady.exec=function(){!isReady&&(isReady=true,cbQueue.add(QBL.crontab.exec),cbQueue.execOnce());};})();QBL.loader=(function(){var _loader,_runner,_onReady,he=document.getElementsByTagName('head')[0],s=document.createElement('script'),isPreload=typeof s.preload=="boolean",isReadyState=isPreload||(s.readyState&&s.readyState=="uninitialized"),isAsync=!isReadyState&&s.async===true,isOperaOrGecko=(window.opera&&Object.prototype.toString.call(window.opera)=="[object Opera]")||("MozAppearance"in document.documentElement.style),isNoReadyState=false,_queue=[],_nodelist={},_counter=0;s=null;_loader=function(src,charset){var se=document.createElement('script'),type='text/javascript';!charset&&(charset='utf-8');se.charset=charset;_queue.push([src,charset]);if(isReadyState||(!isAsync&&!isOperaOrGecko)){if(isReadyState){if(isPreload){se.preload=true;se.onpreload=function(){_counter++;_runner();};}else{se.onreadystatechange=function(){(se.readyState==='loaded')&&(_counter++,_runner());};}}else{if(se.readyState){se.onload=se.onreadystatechange=function(){(se.readyState=='complete'||se.readyState=='loaded')&&(se.onload=se.onreadystatechange=null,se.parentNode.removeChild(se),_counter++,_runner());};}else{isNoReadyState=true;se.addEventListener('load',(function(se){return function(){se.parentNode.removeChild(se);se=null;_counter++;_runner();};})(se),true);}
type='text/cachescript';}}else{isAsync&&(se.async=false);se.onload=se.onreadystatechange=function(){se.readyState?(se.readyState=='complete'||se.readyState=='loaded')&&(se.onload=se.onreadystatechange=null,_counter++,_runner()):(_counter++,_runner());};}
se.type=type;se.src=src;!isReadyState&&he.insertBefore(se,he.firstChild);_nodelist[src]=se;};_runner=function(){if(_counter<_queue.length)return;if(isReadyState||(!isAsync&&!isOperaOrGecko)){if(isReadyState||isNoReadyState){if(isPreload){_onReady();}else{function doExec(i){var src,charset,se;if(i<_queue.length){src=_queue[i][0];charset=_queue[i][1];se=_nodelist[src];charset&&(se.charset=charset);if(!isNoReadyState){se.onreadystatechange=function(){(se.readyState==='complete')&&(se.onreadystatechange=null,doExec(++i));};}else{se=document.createElement('script');charset&&(se.charset=charset);se.addEventListener('load',function(){doExec(++i);},true);se.src=src;}
he.insertBefore(se,he.firstChild);}else{_queue.length=0;_nodelist={};_onReady();}}
doExec(0);}}else{for(var i=0,len=_queue.length;i<len;i++){var se=document.createElement('script'),src=_queue[i][0],charset=_queue[i][1];se.type='text/javascript';charset&&(se.charset=charset);se.src=src;he.insertBefore(se,he.firstChild);}
_onReady();}}else{_onReady();}};return function(files,callback){_onReady=function(){if(!window.QZFL||!QZFL.pageEvents){callback();return;}
QZFL.pageEvents.pageBaseInit=function(){QZFL.pageEvents._onloadHook();QZFL.pageEvents.initHttpParams();};callback();document.addEventListener&&document.readyState==='complete'&&QZFL.pageEvents._onloadHook();}
for(var i=0,len=files.length;i<len;i++){_loader(files[i][0],files[i][1]);}};})();QBL.includeFilesMap={};QBL.include=function(){var mod,ver,res,files=[],filesMap=QBL.includeFilesMap||{},maxage,datetime,file,charset,args=Array.prototype.slice.call(arguments);typeof QBL.timepot.jsloadStart==='undefined'&&(QBL.timepot.jsloadStart=+new Date);for(var i=0,len=args.length;i<len;i++){typeof args[i]==='string'?(file=mod=args[i],charset=ver=''):(file=mod=args[i][0],charset=ver=args[i][1]);if(mod in QBL){res=QBL[mod].getResource(ver);for(var j=0,l=res.length;j<l;j++){if(res[j][0]==='js'){res[j][1]=QBL.include.fillPrefix(res[j][1]);files.push([res[j][1],res[j][2]]);}}
QBL.onReady.add((function(mod){return function(){QBL[mod].execOnReady();};})(mod));}else if(mod in filesMap){file=filesMap[mod][0];charset=filesMap[mod][1]||'utf-8';maxage=filesMap[mod][2]||'';datetime=filesMap[mod][3]||'';file=QBL.include.fillPrefix(file);file+=(file.indexOf('?')<0?'?':'&')+'max_age='+maxage+'&'+datetime;files.push([file,charset]);}else{file=QBL.include.fillPrefix(file);files.push([file,charset]);}}
QBL.include._files=files;setTimeout(function(){QBL.loader(files,QBL.onReady.exec);},0);};QBL.include.fillPrefix=function(file){return file.substr(0,2)!=='//'&&file.substr(0,1)==='/'?'http://'+QBL.config.siDomain+file:file;};QBL.Mshell=function(mod,ver){this.name=mod;this.version=ver||null;this.callbackQueue=new QBL.fnQueue(QBL[mod]);};QBL.Mshell.prototype={getResource:function(ver){},resourceCounter:0,prefetched:-1,prefetch:function(){},mock:function(){var i=0,len,meths=Array.prototype.slice.call(arguments);for(len=meths.length;i<len;i++){this[meths[i]]=this.fshell(meths[i]);}},fshell:function(meth){return(function(_m){return function(){var args=Array.prototype.slice.call(arguments);if(_m.prefetched>0){QBL[_m.name][meth].apply(null,args);}else{_m.callbackQueue.add(QBL[_m.name][meth],args);_m.prefetched<0&&_m.prefetch();}};})(this);},onReady:function(fn){typeof fn==='function'&&(this.callbackQueue.insert(fn));},execOnReady:function(){this.prefetched=1;this.callbackQueue.execOnce();}};(function(){var readyFn=function(){QBL.Mshell.prototype.prefetch=function(ver){var rs,rscount,i=0,len,url,el,urlid,loadFn;if(this.prefetched<0){this.prefetched=0;rs=this.getResource(ver);rscount=rs?rs.length:0;for(;i<rscount;i++){url=rs[i][1];ver&&(url=url.replace(/{VER}/g,ver));url=QBL.include.fillPrefix(url);if(rs[i][0]==='js'){loadFn=QZFL&&QZFL.imports?QZFL.imports:jQuery.getScript;loadFn(url,(function(_m,count){return function(){if(++_m.resourceCounter>=count){_m.execOnReady();_m=null,count=null;}};})(this,rscount));}else{urlid='QBL_AUTOLOAD_'+QBL.genHash(url);if(!document.getElementById(urlid)){el=document.createElement('link');el.id=urlid;el.rel='stylesheet';el.type='text/css';document.getElementsByTagName('head')[0].appendChild(el);el.href=url;}
this.resourceCounter++;}}}};};QBL.JQUERY=new QBL.Mshell('JQUERY');QBL.JQUERY.getResource=function(v){var files;files=[['js',(v?'/ac/lib/jquery/'+v+'/jquery.js':''),'utf-8']];return files;};QBL.JQUERY.onReady(readyFn);window.jQuery&&QBL.JQUERY.execOnReady();QBL.QZFL=new QBL.Mshell('QZFL');QBL.QZFL.getResource=function(v){var files;files=[['js',(v?'/ac/qzone/qzfl/qzfl_'+v+'.js':'/ac/qzfl/release/qzfl_lite.js'),'utf-8'],['css','http://'+QBL.config.siDomain+'/qzonestyle/global/css/qzfl.css']];return files;};QBL.QZFL.onReady(readyFn);window.QZFL&&QBL.QZFL.execOnReady();})();(function(ql){var store=null,engine=null,searchOrder,engines;searchOrder=['localStorage','userData'];engines={localStorage:{test:function(){return!!window.localStorage;},init:function(){store=window.localStorage;},getItem:function(key){return QBL.parseJSON(store.getItem(key));},setItem:function(key,value){typeof value==='object'&&(value=QBL.stringify(value));return store.setItem(key,value);},removeItem:function(key){return store.removeItem(key);}},userData:{test:function(){return window.ActiveXObject?true:false;},init:function(){store=document.documentElement;store.addBehavior('#default#userdata');},getItem:function(key){store.load(key);return QBL.parseJSON(store.getAttribute(key));},setItem:function(key,value){typeof value==='object'&&(value=QBL.stringify(value));store.load(key);store.setAttribute(key,value);return store.save(key);},removeItem:function(key){store.load(key);store.expires=new Date(315532799000).toUTCString();return store.save(key);}}};for(var i=0,l=searchOrder.length,engine;i<l;i++){engine=engines[searchOrder[i]];try{if(engine.test()){engine.init();break;}}catch(ex){engine=null;}}
ql.set=function(key,value){try{return engine.setItem(key,value);}catch(ex){return false;}};ql.get=function(key){try{return engine.getItem(key);}catch(ex){return null;}};ql.remove=function(key){try{return engine.removeItem(key);}catch(ex){return false;}};})(QBL.localStorage={});(function(qs){var SMEDIA,_config={_expire:300000},_isExpired,_allKeys='_QBL_stored_keys_';SMEDIA={memory:(function(){var _datapool={},_md;parent!==window&&(typeof parent.QBL_datastorage==='undefined'&&(parent.QBL_datastorage={}),_datapool=parent.QBL_datastorage);return{set:function(key,val){_datapool[key]=QBL.copydata(val);},get:function(key){return key in _datapool?QBL.copydata(_datapool[key]):null;},remove:function(key){_datapool[key]=null;delete _datapool[key];}}})(),local:{set:function(key,val){QBL.localStorage.set(key,val);},get:function(key){return QBL.localStorage.get(key);},remove:function(key){QBL.localStorage.remove(key);}}};_isExpired=function(data){return data._expire>0&&((new Date).getTime()-data._time>data._expire)?true:false;};qs.get=function(key,media){var sdata;media&&(sdata=SMEDIA[media].get(key));if(sdata){if(!_isExpired(sdata)){return sdata.data;}else{qs.del(key,media);return false;}}else{return false;}};qs.set=function(key,data,cfg){var sdata,skeys;typeof cfg==='undefined'&&(cfg={});cfg.media==='undefined'&&(cfg.media='parent');sdata={data:data,_time:(new Date).getTime(),_expire:cfg.expire||_config._expire};cfg.media=='local'&&key!=_allKeys&&(skeys=qs.get(_allKeys,'local')||{},skeys[key]=1,qs.set(_allKeys,skeys,{media:'local',expire:-1}));return SMEDIA[cfg.media].set(key,sdata);};qs.del=function(key,media){var sdata,skeys,rt=true;typeof media==='string'?(sdata=SMEDIA[media].get(key)):(media='memory',sdata=SMEDIA[media].get(key))||(media='local',sdata=SMEDIA[media].get(key));if(sdata){rt=SMEDIA[media].remove(key);media=='local'&&(skeys=qs.get(_allKeys,'local')||{});skeys&&(key in skeys)&&(skeys[key]=null,delete skeys[key],qs.set(_allKeys,skeys,{media:'local',expire:-1}));}
return rt;};qs.purge=function(){var skeys=qs.get(_allKeys,'local');for(var k in skeys){qs.get(k,'local');}};if(typeof localStorage==='object'&&'remainingSpace'in localStorage){localStorage.remainingSpace<1000000&&setTimeout(QBL.storage.purge,0);}else{QBL.crontab.add(QBL.storage.purge,20000);}})(QBL.storage={});QBL.network=function(url,requestParams,onSuccess,config){var ozmap;!config&&(config={});!requestParams&&(requestParams={});requestParams.callback=config.callbackName;ozmap=QBL.copydata(QBL.network.defaultOzmap);if(config.ozmap){for(var x in config.ozmap){ozmap[x]=config.ozmap[x];}}
config.ozmap=ozmap;this.connectId=QBL.genHash(url);this.ozidFromUrl=this.connectId;this.onSuccess=onSuccess;this.onError=config.onError||QBL.emptyFn;this.onTimeout=config.onTimeout||QBL.emptyFn;this.config=config;this.charset=config.charset||'utf-8';this.method=null;this.response=null;this.connector=null;this.connectHandler=null;this.requestParams=requestParams;this.url=url;this.requestParams=QBL.network.execPlugins('paramsHandler',this).requestParams;this.url=QBL.network.execPlugins('urlHandler',this).url;this.stopRequest=false;this.stopProcessing=false;QBL.network.initSender();};QBL.network.defaultOzmap={};QBL.network.prototype.send=function(){var ch,meth,_m=this;if(this._clearCache){this.clearCache();this._clearCache=null;return;}
if(this.method==='POST'){meth='POST';this.url+=(this.url.indexOf('?')<0?'?callback=':'&callback=')+this.requestParams.callback;}else{meth=this.connectId;}
ch=this.connector=new this.connectHandler(this.url,meth,this.requestParams,this.charset);ch.onSuccess=function(d){if(d){_m.response=d;QBL.network.execPlugins('afterResponse',_m);if(!_m.stopProcessing){_m.onSuccess(d);}else{_m.stopProcessing=false;}}
_m=null;};ch.onError=function(d){QBL.network.execPlugins('onError',_m);_m.onError(d);_m.onSuccess=null;_m=null;};ch.onTimeout=function(d){QBL.network.execPlugins('onTimeout',_m);_m.onTimeout(d);};this.method==='GET'&&(this.storeId=QBL.network.genStoreId(this.url,this.requestParams));QBL.network.execPlugins('beforeRequest',this);if(!this.stopRequest){ch.send(this.config.callbackName);}else{this.stopRequest=false;ch.onSuccess=ch.onError=ch.onTimeout=null;ch=null;}};QBL.network.prototype.resend=function(requestParams){if(requestParams){for(var x in requestParams){this.requestParams[x]=requestParams[x];};}
this.send();},QBL.network.prototype.retry=function(){this.clearCache();this.send();};QBL.network.prototype.clearCache=function(){if(this.method==='GET'){this.url=this.url.replace(/(\?|&)(d=)[^&]+/,'$1$2'+QBL.network.seed.set(this.connectId));this.config.cache&&QBL.storage.del(this.storeId,this.config.cacheMedia);}};QBL.network.genStoreId=function(url,params){var storeId,str=[url];if(params){for(var x in params){str.push(x+'='+params[x]);}}
storeId='_'+QBL.genHash(str.join('&'));return storeId;};QBL.network.seed={_prefix:'QBLSEED-',set:function(k,v){if(!k){return 0;}
k=QBL.network.seed._prefix+k;typeof v==='undefined'&&(v=Math.random());QBL.storage.set(k,v,{media:'local',expire:600000});return v;},get:function(k){var v,_t;if(!k){return 0;}
_t=QBL.network.seed._prefix+k;v=QBL.storage.get(_t,'local');if(!v){v=Math.random();QBL.network.seed.set(k,v);}
return v;}};QBL.network.plugins={urlHandler:null,paramsHandler:null,beforeRequest:null,afterResponse:null,onError:null,onTimeout:null};QBL.network.addPlugin=function(type,plugin){var pl=QBL.network.plugins;type in pl&&(!pl[type]&&(pl[type]=new QBL.fnQueue()),pl[type].add(plugin));};QBL.network.execPlugins=function(type,data){var pools=QBL.network.plugins[type],fn,i=0,rt,args=Array.prototype.slice.call(arguments,2);if(pools){while(fn=pools.get(i++)){rt=fn[0].apply(null,[data].concat(args));(type==='urlHandler'||type==='paramsHandler')&&(data=rt);}}
return data;};QBL.network.addPlugin('urlHandler',function(ch){var p=[],url=ch.url,skey;url.indexOf('?')<0&&(url+='?');url.slice(-1)!=='?'&&p.push('');skey=document.cookie.match(/(?:^|;+|\s+)skey=([^;]*)/);skey=skey?skey[1]:'';p.push('g_tk='+QBL.genHash(skey));p.push('d_p='+QBL.network.seed.get(ch.connectId));ch.url=url+p.join('&');return ch;});QBL.network.addPlugin('beforeRequest',function(ch){var url=ch.url,ps=[],requestParams=ch.requestParams;if(requestParams){for(var x in requestParams){ps.push(x+'='+requestParams[x]);};url+=(url.indexOf('?')<0?'?':'&')+ps.join('&');ch.ozidFromUrl=QBL.genHash(url);}
QBL.monitorCgi.create(ch.ozidFromUrl,url,{ozid:ch.config.ozid});});QBL.network.addPlugin('afterResponse',function(ch){QBL.monitorCgi.mark(ch.ozidFromUrl);setTimeout(function(){var code,ozmap;ozmap=ch.config.ozmap;code=ozmap[ch.response.ret];!code&&(code='OTHER'in ozmap?ozmap.OTHER:12);QBL.monitorCgi.report(code,code<50?true:false,ch.ozidFromUrl);},0);});QBL.network.addPlugin('onError',function(ch){var code,ozmap;if(ch){ozmap=ch.config.ozmap;code='ERROR'in ozmap?ozmap.ERROR:51;QBL.monitorCgi.report(code,false,ch.ozidFromUrl);}});QBL.network.addPlugin('onTimeout',function(ch){});QBL.network.addPlugin('afterResponse',function(ch){if(ch.method==='GET'&&ch.config.cache&&ch.response.ret===0){QBL.storage.set(ch.storeId,ch.response,{media:ch.config.cacheMedia||'memory',expire:ch.config.cacheExpire});}});QBL.network.addPlugin('beforeRequest',function(cn){var d,cfg=cn.config;cfg.cache&&(!('cacheMedia'in cfg)&&(cfg.cacheMedia='memory'),d=QBL.storage.get(cn.storeId,cfg.cacheMedia))&&(cn.stopRequest=true,cn.connector.onSuccess(d));});QBL.network.isSenderInited=false;QBL.network.initSender=function(){var sender;if(QBL.network.isSenderInited){return;}
QBL.network.isSenderInited=true;if(window.QZFL){QBL.JSONGetter=QZFL.JSONGetter;QBL.FormSender=QZFL.FormSender;}else{sender=function(url,meth,data,charset){this.url=url;this.data=data;this.method=meth;this.charset=charset;this.onSuccess=function(){};};sender.prototype.send=function(callback){var data=this.data||{},callback,url,reqid,params;reqid=QBL.network.genStoreId(this.url,data);if(this.method==='POST'){callback=callback.replace(/\./g,'_').replace('&script','');callback+=reqid;url=this.url.replace('frameElement.callback&script',callback);data.callback=null;delete data.callback;}else{callback+=reqid;data.callback=callback;url=this.url;}
window[callback]=(function(m,callback){return function(d){m.onSuccess(d);window[callback]=null;delete window[callback];};})(this,callback);params={url:url,data:data,dataType:'script'};this.method=='POST'&&(params.type='POST');jQuery.ajax(params);};QBL.JSONGetter=function(url,meth,data,charset){this.url=url;this.data=data;this.method=meth;this.charset=charset;this.onSuccess=function(){};};QBL.JSONGetter.prototype=sender.prototype;QBL.FormSender=function(url,meth,data,charset){this.url=url;this.data=data;this.method=meth;this.charset=charset;this.onSuccess=function(){};};QBL.FormSender.prototype=sender.prototype;}};QBL.clearCache=function(cgiMeth){typeof cgiMeth==='function'&&(cgiMeth._clearCache=true,cgiMeth());};QBL.getter=function(url,requestParams,onSuccess,config){var conn,func,i=0;!config&&(config={});!config.callbackName&&(config.callbackName='_Callback');conn=new QBL.network(url,requestParams,onSuccess,config);conn.method='GET';conn._clearCache=null;func=arguments.callee;do{func=func.caller;if(!func){break;}
if(typeof func._clearCache!=='undefined'){conn._clearCache=func._clearCache;func._clearCache=null;break;}}while(++i<3&&func.caller);conn.connectHandler=config.connectHandler||QBL.JSONGetter;conn.send();return conn;};QBL.poster=function(url,requestParams,onSuccess,config){var conn,handler;!config&&(config={});config.callbackName='frameElement.callback&script';conn=new QBL.network(url,requestParams,onSuccess,config);conn.method='POST';conn.connectHandler=config.handler||QBL.FormSender;conn.send();return conn;};QBL.downloader=QBL.poster;QBL.FileUploader=function(actionURL,cname,data){this.name="__QBsubmit__"+(cname||QBL.FileUploader.counter++);QBL.FileUploader.instance[this.name]=this;this.uri=actionURL;this.data=(typeof data==='object'||typeof data==='string')?data:null;this._frame=null;this._form=null;this._file=null;this.onSuccess=QBL.emptyFn;this.onError=QBL.emptyFn;this.onTimeout=QBL.emptyFn;};QBL.FileUploader.instance={};QBL.FileUploader.counter=0;QBL.FileUploader.prototype.send=function(){var frmId=this.name+'frm__',formId=this.name+'form__',frmEl,wrapFrm,data=this.data;wrapFrm=document.createElement('div');wrapFrm.innerHTML='<iframe id="'+frmId+'" name="'+frmId+'" src="javascript:document.open();document.domain=\''+document.domain+'\';document.close();void(0);" width="1px" height="1px" style="display:none"></iframe>';document.body.appendChild(wrapFrm.firstChild);wrapFrm=null;this._frame=$(frmId);frmEl=document.createElement('form');frmEl.id=frmEl.name=formId;frmEl.method='POST';frmEl.enctype=frmEl.encoding='multipart/form-data';frmEl.target=frmId;frmEl.style.cssText='display:none';document.body.appendChild(frmEl);this._form=frmEl;this._frame.callback=(function(_m){return function(d){document.body.removeChild(_m._form);document.body.removeChild(_m._frame);_m.onSuccess(d);_m=null;};})(this);var df=document.createDocumentFragment(),tmp,elist;this._file=[];if('_file'in data){for(var x in data._file){var el=data._file[x],l,cloneEl;typeof el==='string'&&(el=$(el));cloneEl=el.cloneNode(true);el.style.display='none';if(el.eventsListUID&&(l=QZFL.event._eventListDictionary[el.eventsListUID])){elist=QBL.copydata(l);for(var eventType in elist){for(var k in elist[eventType]){$e(cloneEl).bind(eventType,elist[eventType][k]);}}}
el.parentNode.insertBefore(cloneEl,el);this._form.appendChild(el);this._file.push([el,cloneEl]);}}
for(var k in data){if(k!=='_file'){tmp=document.createElement('input');tmp.name=k;tmp.type='hidden';tmp.value=data[k];df.appendChild(tmp);}}
this._form.appendChild(df);this._form.action=this.uri;setTimeout((function(_m){return function(){var files=_m._file;_m._form.submit();for(var i=0,l=files.length;i<l;i++){files[i][1].parentNode.insertBefore(files[i][0],files[i][1]);files[i][0].style.display='';files[i][1].parentNode.removeChild(files[i][1]);}
_m._file=null;_m=null;};})(this),0);};QBL.uploader=function(url,requestParams,onSuccess,config){var conn,handler;!config&&(config={});config.callbackName='frameElement.callback&script';conn=new QBL.network(url,requestParams,onSuccess,config);conn.method='POST';conn.connectHandler=config.handler||QBL.FileUploader;conn.send();return conn;};QBL.stat=new QBL.Mshell('stat');QBL.stat.getResource=function(){return[['js','/ac/qzfl/stat.js','utf-8']];};QBL.stat.mock('cgiReturn','pageSpeed','pvuv','hotclick');(function(M){var instance={_pool:{},get:function(iname,type){typeof iname==='undefined'&&(iname=this[type+'current']);return this._pool[type+iname];},set:function(ist,iname,type){typeof iname==='undefined'&&(iname=this[type+'current']);this._pool[type+iname]=ist;return this[type+'current']=iname;},destroy:function(iname,type){iname=!iname&&type==='page-'?this[type+'current']:(iname||'');iname=type+iname;if(iname in this._pool){this._pool[iname]=null;delete this._pool[iname];}}},reporter,sendRunning=false,sendData=[],sendDelay=1000,sendTimer=null,sendCurrentCount=0,sendMaxCount=10;reporter={init:function(){return window.TCISD;},send:function(callback,args){var cmp=this.init();if(!cmp){QZFL.imports('http://'+QBL.config.siDomain+'/ac/qzfl/stat.js',function(){(reporter.init())[callback].apply(null,args);},{charset:'utf-8'});return;}else{return cmp[callback].apply(null,args);}},batchSender:function(){var params=[],rate,item,i,img;sendCurrentCount++;if(sendCurrentCount>=sendMaxCount&&!sendData.length){clearTimeout(sendTimer);sendRunning=false;sendCurrentCount/=2;sendDelay=1000;return;}
if(sendData.length){params.push('key='+'domain,cgi,type,code,time,rate');i=0;while(sendData.length){if(params.join('&').length>1000){break;}
item=sendData.shift();rate=item[5]||1;if(Math.random()>1/rate){continue;}
i++;params.push(i+'_1='+item[0]);params.push(i+'_2='+item[1]);params.push(i+'_3='+item[2]);params.push(i+'_4='+item[3]);params.push(i+'_5='+item[4]);params.push(i+'_6='+item[5]);}
if(i>0){params.push('r='+Math.random());img=new Image();img.src='http://c.isdspeed.qq.com/code.cgi?'+params.join('&');}}
sendTimer=setTimeout(reporter.batchSender,sendDelay);sendDelay*=1.1;},valueStat:function(ist,issuccess,code,exts){var domain,type,time,rate,path='',mat,mod,act,ver,cgi,id;rate=exts.reportRate||1;time=exts.duration;cgi=ist.cgi;id=ist.ozid;!cgi&&(cgi='http://e.qq.com/unknow');mat=cgi.match(/^https?\:\/\/([^\/]+)($|\/[^\?\#]*)/i);mat?(domain=mat[1],path=mat[2]):(domain='e.qq.com',path='/NOHOST/'+cgi);if(cgi.indexOf('.php?')>-1){mod=cgi.match(/(?:\?|&)mod=([^&]+|$)/i);act=cgi.match(/(?:\?|&)act=([^&]+|$)/i);ver=cgi.match(/(?:\?|&)ver=([^&]+|$)/i);cgi=[];cgi.push(mod?mod[1]:'MOD');cgi.push(act?act[1]:'ACT');ver&&cgi.push(ver);cgi=path+'?'+cgi.join('_');}else{cgi=mat?path:(domain+path);}
cgi=encodeURIComponent(cgi);type=issuccess;sendData.push([domain,cgi,type,code,time,rate]);if(!sendRunning){sendRunning=true;setTimeout(reporter.batchSender,sendDelay);}},createTimeStat:function(){var ist=this.send('createTimeStat',arguments),_m=this;if(!ist){ist={mark:function(){_m.send('mark',arguments);},report:function(){_m.send('report',arguments);},setZero:function(){_m.send('setZero',arguments);}};}
return ist;},pv:function(){this.send('pv',arguments);},hotClick:function(){this.send('hotClick',arguments);},stringStat:function(){this.send('stringStat',arguments);}};M.monitorCgi={create:function(rname,cgi,conf){var ist;conf=conf||{};if(!isNaN(cgi)){conf.ozid=cgi;cgi='http://e.qq.com/'+(rname||('OLD/'+cgi));}
conf.timeout=conf.timeout||10000;ist={starttime:new Date,cgi:cgi};conf.ozid&&(ist.ozid=conf.ozid);if(conf.timeout>0){ist.timeout=conf.timeout;conf.timeout=null;delete conf.timeout;ist.timer=setTimeout(function(){conf.duration=ist.timeout;M.monitorCgi.report(3,2,conf);},ist.timeout);}
ist.conf=conf;instance.set(ist,rname,'cgi-');return ist;},mark:function(rname){var ist=instance.get(rname,'cgi-');ist&&(ist.endtime=new Date);},report:function(code,issuccess,rname){var ist=instance.get(rname,'cgi-'),conf;if(ist){ist.timeout>0&&clearTimeout(ist.timer);!ist.endtime&&(ist.endtime=new Date);conf=ist.conf||{reportRate:1};issuccess=typeof issuccess==='undefined'?1:(issuccess?1:2);reporter.valueStat(ist,issuccess,code,{reportRate:conf.reportRate,duration:conf.duration||(ist.endtime-ist.starttime)});instance.destroy(rname,'cgi-');}}};M.monitorPage={create:function(sname){var ist=reporter.createTimeStat.apply(reporter,arguments),pagetime=window._PAGE_TIME;if(typeof pagetime!=='undefined'){ist.setZero(pagetime[0]);pagetime.length>1&&ist.mark(1,pagetime[1]);}
instance.set(ist,sname,'page-');return ist;},mark:function(seq,sname,time){var ist=instance.get(sname,'page-');ist&&ist.mark.call(ist,seq,time);},report:function(sname){var ist=instance.get(sname,'page-');ist&&ist.report.call(ist);instance.destroy(sname,'page-');}};M.monitorPV={report:function(){reporter.pv.apply(reporter,arguments);}};M.monitorClick={report:function(){reporter.hotClick.apply(reporter,arguments);}};M.stringStat=function(){reporter.stringStat.apply(reporter,arguments);};})(QBL);(function(qt){var cache={};qt.tmpl=function tmpl(str,data){var fn=!/\W/.test(str)?cache[str]=cache[str]||tmpl(document.getElementById(str).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+
str.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")
+"');}return p.join('');");return data?fn(data):fn;};})(QBL);QBL.delegate=function(wrap,eventType,fnMap,opts){!wrap.nodeType&&(wrap=$(wrap));if(!wrap||wrap.nodeType!==1&&wrap.nodeType!==9){return;}
opts=opts||{};QZFL.event.addEvent(wrap,eventType,function(evt){var tarEl,notDOMEvent,evt,opt,cnt=0;evt=QZFL.event.getEvent(evt);notDOMEvent={'keypress':1,'keydown':1,'keyup':1};if(eventType in notDOMEvent){opt=evt.keyCode;}else{tarEl=QZFL.event.getTarget(evt);if(tarEl.disabled){return;}
do{opt=tarEl.getAttribute('opt');}while(!opt&&cnt++<2&&(tarEl=tarEl.parentNode));}
if(opt&&opt in fnMap){var evtdata={type:eventType,event:evt,target:tarEl},rt=true;opts.preevent&&(rt=opts.preevent.call(tarEl,evtdata));return rt!==false?fnMap[opt].call(tarEl,evtdata):'';}});};QBL.pager=new QBL.Mshell('pager');QBL.pager.getResource=function(v){return[['js',QBL.config.widgetDir+'pager/pager.js','utf-8']];};QBL.pager.mock('init');QBL.pager.onReady(function(){QBL.pager.init=function(el,config,onTurn){var instance;typeof el==='string'&&(el=$(el));config=config||{};config.onTurn=onTurn||QBL.emptyFn;config.currentPage=config.page;config.pageSize=config.pagesize;config.totalNum=config.total;config.total<1&&(el.innerHTML='');instance=new F4A.widget.Pager(el,config);return instance;};});QBL.calendar=new QBL.Mshell('calendar');QBL.calendar.getResource=function(v){return[['js',QBL.config.widgetDir+'calendar/calendar.js','utf-8']];};QBL.calendar.mock('init','setDate');QBL.calendar.onReady(function(){var _pools={};QBL.calendar.init=function(el,onSelect,config){var datepicker,t,id;config=QZFL.object.extend({mode:0,yearPattern:'-',monthPattern:'-',datePattern:'',connectString:'',value:''},config||{});typeof el==='string'&&(el=$(el));datepicker=QZFL.widget.calendar.bind(el,config.mode);QZFL.object.extend(datepicker,config);t=datepicker.onDateSelected;datepicker.onDateSelected=function(d){t&&t(d);onSelect&&onSelect(d);};id=datepicker._target.id;_pools[id]=datepicker;!config.value&&(config.value=el.value);config.value&&QBL.calendar.setDate(id,config.value);return datepicker;};QBL.calendar.setDate=function(elId,date,config){var datepart,dateObj=date,val;config=config||{};if(date&&typeof date!=='object'){if(isNaN(date)){datepart=date.match(/(\d+)[^\d]*(\d+)[^\d]*(\d+)[^\d]*/);if(datepart&&datepart.length>2){date=Date.UTC(datepart[1],datepart[2]-1,datepart[3],0,0,0);}else{return;}}
dateObj=new Date(date);}
if(typeof elId!='string'){try{elId=J(elId).attr('id');}catch(e){}}
if(elId in _pools){if(date){_pools[elId].setDate(dateObj);val=QZFL.string.timeFormatString(dateObj.getTime(),config.format||'{Y}-{M}-{d}');}
document.getElementById(elId).value=val||'';}};QBL.calendar.hide=function(elId){if(elId in _pools){_pools[elId].hide();}};});QBL.chart=new QBL.Mshell('chart');QBL.chart.getResource=function(v){return[['js',QBL.config.widgetDir+'flashchart/commonchart.js','utf-8'],['swf',QBL.config.widgetDir+'flashchart/chart.swf?readyCallBack=getChartData']];};QBL.chart.mock('line','bar','pie','map');QBL.chart.onReady(function(){var QC=QBL.chart,swf,resource;QC._cache={};resource=QC.getResource();for(var i=0,l=resource.length;i<l;i++){if(resource[i][0]==='swf'){swf=resource[i][1];break;}}
try{swf&&(GDT.chart.swfPath=swf);}catch(err){}
QC.getInstance=function(id){var chart=null;if(id&&(id in QC._cache)){chart=QC._cache[id];if(!chart||!chart.ctrl||!chart.ctrl.id||!document.getElementById(chart.ctrl.id)){chart=null;}}
return chart;};QC.setInstance=function(id,chart){id&&(QC._cache[id]=chart);return chart;};QC.line=function(id,data,opts){var chart,cfg={},fields;if(!id||typeof data!=='object'){return;}
typeof opts!=='object'&&(opts={});fields=opts.fields;for(var x in fields){fields[x].cType='line';for(var i=0,l=data.length;i<l;i++){data[i].title=data[i][fields[x].title]+'';}}
data={ds:{ret:0,data:{data:data}},pre:opts.pre||'',needbox:true}
if(!(chart=QC.getInstance(id))){cfg.sep=opts.separator||'$';cfg.cstXa=typeof opts.cstXa!=='undefined'?opts.cstXa:true;opts.colormap&&(cfg.colmap=opts.colormap);chart=new AnalysisC.flashChartHandler(id,function(r,key,sep){return AnalysisC.dataAdaptor.linecommon(r,key,fields,cfg);},data);chart.insertTo(opts.width||960,opts.height||280);QC.setInstance(id,chart);}else{chart.loadData(data.ds);}};QC.bar=function(id,data,opts){var chart,keys=[],namemap={},cfg={},isKeysEmpty=false,isNamemapEmpty=false;if(!id||typeof data!=='object'){return;}
typeof opts!=='object'&&(opts={});data={ds:{ret:0,data:data},pre:opts.pre||''};if(!(chart=QC.getInstance(id))){!opts.keys&&(isKeysEmpty=true);!opts.namemap&&(isNamemapEmpty=true);if(isKeysEmpty||isNamemapEmpty){for(var x in data){keys.push(x);namemap[x]=x;}
isKeysEmpty&&(opts.keys=keys);isNamemapEmpty&&(opts.namemap=namemap);}
cfg.aidmap={};opts.colormap&&(cfg.colmap=opts.colormap);chart=new AnalysisC.flashChartHandler(id,function(d,key){return AnalysisC.dataAdaptor.barcommon(d.data,opts.keys,opts.namemap,cfg);},data);chart.insertTo(opts.width||960,opts.height||280);QC.setInstance(id,chart);}else{chart.loadData(data.ds);}};QC.pie=function(id,data,opts){var chart,keys=[];if(!id||typeof data!=='object'){return;}
if(!(chart=QC.getInstance(id))){typeof opts!=='object'&&(opts={});if(!opts.keys&&data.ds&&data.ds.data){for(var x in data.ds.data){keys.push(x);}
opts.keys=keys;}
chart=new AnalysisC.flashChartHandler(id,function(r,key){return AnalysisC.dataAdaptor.piecommon(r.data,opts.keys,opts.colors);},data);chart.insertTo(opts.width||210,opts.height||230);QC.setInstance(id,chart);}else{data.ds&&chart.loadData(data.ds);}};QC.map=function(id,data,opts){var chart;if(!id||typeof data!=='object'){return;}
window.loadAnalysisMapData=function(){return data;};typeof opts!=='object'&&(opts={});chart=GDT.chart.insertTo(id,opts.width||430,opts.height||350,QBL.config.widgetDir+'flashchart/maps.swf');};});})();
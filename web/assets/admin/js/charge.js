
(function(VCharge){VCharge.init=function(){var _m=GDT.viewCharge;if(GDT.account.canCharge()){if(GDT.accountInfo.status==GDT.ENV.userStatusPrepare||GDT.accountInfo.status==GDT.ENV.userStatusValidating||GDT.accountInfo.status==GDT.ENV.userStatusInvalidate){J('#chargetip').text('您还不是有效账号，请在账号中心补全信息，审核通过后，方可进行充值').css({marginTop:'10px',display:'inline-block'});J('#chargeSubmit').hide();}else{J('#_charge').removeClass('none');}}
GDT.speed.create('viewCharge',[175,366,11]);J('#_acntName').html(GDT.accountInfo.logname);function focusEl(){sel('custom');}
function sel(amount){J('#chooseAmount [rel]').removeClass('on');J('#chooseAmount [rel='+amount+']').addClass('on');var action=amount=='custom'?'removeClass':'addClass';J('#cusomAcmoutcnt')[action]('none');}
J('#chooseAmount [rel]').bind('click',function(evt){var target=J(this),amount;amount=target.attr('rel');sel(amount);});J('#custom').bind('click',focusEl).bind('focus',focusEl).bind('blur',function(){GDT.viewCharge.checkAmount(J.trim(this.value));}).keyup(function(){GDT.viewCharge.checkAmount(J.trim(this.value));});J('#chargeSubmit').bind('click',function(){var amount=J.trim(J('#chooseAmount .on[rel]').attr('rel')),loadingPage=GDT.ENV.HTMLPATH+'account/loading';errorPage=GDT.ENV.HTMLPATH+'account/loading?err';if(!amount){GDT.util.showMsgbox('请选择充值金额',0,2000);return false;}
if(amount==='custom'){amount=J.trim($('custom').value);}
if(!GDT.viewCharge.checkAmount(amount)){return false;}
var ptdata={p_uin:GDT.accountInfo.loguid,skey:QZFL.cookie.get("skey"),u1:'https://www.tenpay.com/v2.0/none.html',win:'self'},sender;sender=new QZFL.FormSender('https://www.tenpay.com/cgi-bin/v1.0/communitylogin.cgi','post',ptdata,'gb2312');sender.onSuccess=function(){};sender.onError=function(){};sender.send();var wname='_payWin'+Math.ceil(1+Math.random()*100000).toString(),win=window.open(loadingPage,wname);if(!win){alert('支付窗口被拦截，请先允许新开窗口，再进行充值');return false;}
win.focus();GDT.cgiAccount.charge(amount,function(d){if(d.ret===0){var params=[];QZFL.object.each(d.data,function(v,k){params.push(k+'='+v);});var cf=new GDT.util.Confirm('提示','请在新打开的网页上支付广点通广告费用',{'icontype':'warn','type':QZFL.widget.Confirm.TYPE.OK_NO,'hastitle':false,'height':120,'tips':['查余额','取消']});cf.onConfirm=function(){GDT.viewAccount.loadAccountInfo();};cf.onNo=function(){};cf.show();win=window.open('https://gw.tenpay.com/gateway/pay.htm?'+params.join('&'),wname);win.focus();GDT.localStorage.setItem('chargeData_tradeno',d.data.out_trade_no);GDT.localStorage.setItem('chargeData_amount',amount);}else{GDT.util.showMsgbox('抱歉，跳转财付通失败，请重新充值',0,1000);window.open(errorPage,wname);}});TCISD.hotClick('eccast.account.charge.'+amount,'gdt.qq.com');var section=[1000,5000,8000,10000,20000,50000,100000,200000,400000,600000,800000],sect,i;for(i=section.length-1;i>=0;i--){if(amount>=section[i]){sect=section[i];break;}}
sect&&TCISD.hotClick('eccast.account.formatcharge.'+sect,'gdt.qq.com');return false;});};VCharge.checkAmount=function(amount){var tips=J('#_tips'),el=$('custom'),o2o_tips='<strong class="icon_hint"><span>提示</span></strong><span>请输入1000-10000000的整数</span>',min=1000,max=10000000;tips.addClass('c-red');if(GDT.account.isO2o()){min=1000,tips.html(o2o_tips);}
if(isNaN(amount)||amount<min||amount>max||parseInt(amount,10)!=amount){tips.removeClass('none');return false;}else{tips.addClass('none');return true;}};})(GDT.viewCharge={});